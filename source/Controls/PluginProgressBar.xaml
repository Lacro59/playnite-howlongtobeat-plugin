<controls:PluginUserControlExtend
    xmlns:controls="clr-namespace:CommonPluginsShared.Controls"
    x:Class="HowLongToBeat.Controls.PluginProgressBar"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:HowLongToBeat.Controls"
    xmlns:controlsShared="clr-namespace:CommonPluginsControls.Controls"
    xmlns:converters="clr-namespace:CommonPlayniteShared.Converters"
    mc:Ignorable="d"
    d:DesignHeight="80"
    d:DesignWidth="800"
    d:DataContext="{d:DesignInstance local:PluginProgressBarDataContext, IsDesignTimeCreatable=True}">

    <controls:PluginUserControlExtend.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:StringNullOrEmptyToBoolConverter x:Key="StringNullOrEmptyToBoolConverter"/>
    </controls:PluginUserControlExtend.Resources>

    <Grid Name="PART_GridContener">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0" Margin="0,-20,0,0">
            <controlsShared:ProgressBarExtend x:Name="PART_ProgressBarThird"
                                              Background="Transparent"
                                              MarginLeft="0"
                                              MarginRight="0"
                                              TextWidth="0"
                                              Minimum="0"/>
            <controlsShared:ProgressBarExtend x:Name="PART_ProgressBarSecond"
                                              Background="Transparent"
                                              MarginLeft="0"
                                              MarginRight="0"
                                              TextWidth="0"
                                              Minimum="0"/>
            <controlsShared:ProgressBarExtend x:Name="PART_ProgressBarFirst"
                                              Background="Transparent"
                                              LayoutUpdated="PART_ProgressBarFirst_LayoutUpdated"
                                              MarginLeft="0"
                                              MarginRight="0"
                                              TextWidth="0"
                                              Minimum="0"/>

            <Slider Name="SliderPlaytime"
                    Margin="-6,0,-6,0"
                    Value="0"
                    Height="{Binding ElementName=PART_ProgressBarFirst, Path=IndicatorHeight}"
                    VerticalAlignment="Center">
                <Slider.Style>
                    <Style TargetType="{x:Type Slider}"
                           BasedOn="{StaticResource {x:Type Slider}}">
                        <Setter Property="SnapsToDevicePixels"
                                Value="True"/>
                        <Setter Property="Background"
                                Value="{DynamicResource ControlBackgroundBrush}"/>
                        <Setter Property="BorderBrush"
                                Value="{DynamicResource NormalBorderBrush}"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="{x:Type Slider}">
                                    <Grid Name="GridRoot">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="2"/>
                                            <RowDefinition Height="*"/>
                                            <RowDefinition Height="2"/>
                                        </Grid.RowDefinitions>
                                        <TickBar x:Name="TopTick"
                                                 Visibility="Hidden"
                                                 Placement="Top"
                                                 SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"
                                                 Fill="{DynamicResource GlyphBrush}"/>
                                        <Track Grid.Row="1"
                                               Name="PART_Track"
                                               VerticalAlignment="Center">
                                            <Track.Thumb>
                                                <Thumb Name="SliderPlaytimeThumb"
                                                       Width="12"
                                                       Height="12"
                                                       SnapsToDevicePixels="True"
                                                       IsEnabled="False"
                                                       VerticalAlignment="Center">
                                                    <Thumb.Style>
                                                        <Style TargetType="{x:Type Thumb}">
                                                            <Setter Property="Background" Value="{Binding ThumbColor}"/>
                                                            <Setter Property="Template">
                                                                <Setter.Value>
                                                                    <ControlTemplate TargetType="{x:Type Thumb}">
                                                                        <Grid VerticalAlignment="Center" HorizontalAlignment="Center">
                                                                            <Polygon Points="6,0 12,12 0,12" Fill="{TemplateBinding Background}" Stroke="{TemplateBinding Background}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                                        </Grid>
                                                                    </ControlTemplate>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Style>
                                                    </Thumb.Style>
                                                </Thumb>
                                            </Track.Thumb>
                                        </Track>
                                        <TickBar Name="BottomTick"
                                                 Visibility="Hidden"
                                                 Grid.Row="2"
                                                 Placement="Bottom"
                                                 SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"
                                                 Fill="{TemplateBinding Foreground}"/>
                                    </Grid>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsFocused"
                                                 Value="True">
                                            <Setter TargetName="PART_Track"
                                                    Property="FocusManager.FocusedElement"
                                                    Value="{Binding ElementName=PART_Track}"/>
                                        </Trigger>
                                        <Trigger Property="TickPlacement"
                                                 Value="TopLeft">
                                            <Setter Property="Visibility"
                                                    Value="Visible"
                                                    TargetName="TopTick"/>
                                        </Trigger>
                                        <Trigger Property="TickPlacement"
                                                 Value="BottomRight">
                                            <Setter Property="Visibility"
                                                    Value="Visible"
                                                    TargetName="BottomTick"/>
                                        </Trigger>
                                        <Trigger Property="TickPlacement"
                                                 Value="Both">
                                            <Setter Property="Visibility"
                                                    Value="Visible"
                                                    TargetName="TopTick"/>
                                            <Setter Property="Visibility"
                                                    Value="Visible"
                                                    TargetName="BottomTick"/>
                                        </Trigger>
                                        <Trigger Property="Orientation"
                                                 Value="Vertical">
                                            <Setter Property="LayoutTransform"
                                                    TargetName="GridRoot">
                                                <Setter.Value>
                                                    <RotateTransform Angle="-90"/>
                                                </Setter.Value>
                                            </Setter>
                                            <Setter TargetName="PART_Track"
                                                    Property="Orientation"
                                                    Value="Horizontal"/>
                                        </Trigger>

                                        <DataTrigger Binding="{Binding DataContext.PlaytimeValue, RelativeSource={RelativeSource AncestorType={x:Type controls:PluginUserControlExtend}}}" Value="0">
                                            <Setter TargetName="SliderPlaytimeThumb" Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>

                        <Style.Triggers>
                            <!-- Only TextBelowVisibility is supported now -->
                            <DataTrigger Binding="{Binding TextBelowVisibility}"
                                         Value="True">
                                <Setter Property="VerticalAlignment"
                                        Value="Top"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Slider.Style>
            </Slider>

            <Grid Name="PART_SliderUserContener"
                  Height="{Binding ElementName=PART_ProgressBarFirst, Path=IndicatorHeight}"
                  ClipToBounds="True">
                <Grid.Style>
                    <Style TargetType="{x:Type Grid}">
                        <Style.Triggers>
                            <!-- Only TextBelowVisibility is supported now -->
                            <DataTrigger Binding="{Binding TextBelowVisibility}"
                                         Value="True">
                                <Setter Property="VerticalAlignment"
                                        Value="Top"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Grid.Style>

                <controlsShared:SliderWithPointer x:Name="PartSliderFirst"
                                                  VerticalAlignment="Bottom"
                                                  Height="{Binding ElementName=PART_ProgressBarFirst, Path=IndicatorDemiHeight}"
                                                  Margin="{Binding ElementName=SliderPlaytime, Path=Margin}"/>

                <controlsShared:SliderWithPointer x:Name="PartSliderSecond"
                                                  VerticalAlignment="Bottom"
                                                  Height="{Binding ElementName=PART_ProgressBarFirst, Path=IndicatorDemiHeight}"
                                                  Margin="{Binding ElementName=SliderPlaytime, Path=Margin}"/>

                <controlsShared:SliderWithPointer x:Name="PartSliderThird"
                                                  VerticalAlignment="Bottom"
                                                  Height="{Binding ElementName=PART_ProgressBarFirst, Path=IndicatorDemiHeight}"
                                                  Margin="{Binding ElementName=SliderPlaytime, Path=Margin}"/>
            </Grid>
        </Grid>
        <StackPanel x:Name="PART_TimeTexts" Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,-20,0,0" VerticalAlignment="Top"
                    Visibility="{Binding TextBelowVisibility, Converter={StaticResource BooleanToVisibilityConverter}}">
            <TextBlock x:Name="PART_TimeText1" TextTrimming="CharacterEllipsis" VerticalAlignment="Center" Margin="0,0,2,0" Foreground="{Binding ThumbFirst}" Visibility="Collapsed" />
            <TextBlock x:Name="PART_TimeSep12" Text=" - " Margin="2,0" VerticalAlignment="Center" Visibility="Collapsed" />
            <TextBlock x:Name="PART_TimeText2" TextTrimming="CharacterEllipsis" VerticalAlignment="Center" Margin="2,0,2,0" Foreground="{Binding ThumbSecond}" Visibility="Collapsed" />
            <TextBlock x:Name="PART_TimeSep23" Text=" - " Margin="2,0" VerticalAlignment="Center" Visibility="Collapsed" />
            <TextBlock x:Name="PART_TimeText3" TextTrimming="CharacterEllipsis" VerticalAlignment="Center" Margin="2,0,0,0" Foreground="{Binding ThumbThird}" Visibility="Collapsed" />
        </StackPanel>
    </Grid>
</controls:PluginUserControlExtend>
